@inherits LayoutComponentBase

@inject IJSRuntime JSRuntime


<MudThemeProvider IsDarkMode="_IsDarkModeEnabled" />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="ToggleDrawer" />
        <MudSpacer />
        <MudToggleIconButton Toggled="@_IsDarkModeEnabled" ToggledChanged="ToggleDarkMode" Icon="@Icons.Material.Filled.LightMode" Color="Color.Inherit" ToggledIcon="@Icons.Material.Outlined.DarkMode" />
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Elevation="1" ClipMode="DrawerClipMode.Never" Variant="DrawerVariant.Persistent" Anchor="Anchor.Left">
        <MudContainer Style="height: 100%; display: flex; padding: 0; overflow-x: hidden;">
            <div class="d-flex flex-column w-100">
                <div class="d-flex flex-row" style="flex: 1;">
                    <div class="p-3 flex-grow-1 m-3" style="position: relative; border-right: 1px solid rgba(0, 0, 0, 0.12)">
                        <div class="d-flex justify-content-center align-items-center h-100 mt-3" style="margin-bottom: 10px;">
                            <MudAvatar Src="icons/favicon.ico" />
                        </div>
                        <MudIconButton Icon="@Icons.Material.Filled.ChatBubble"></MudIconButton>
                        <div style="position: absolute; bottom: 0; left: 0; right: 0;">
                            <MudIconButton Icon="@Icons.Material.Filled.Settings" />
                        </div>
                    </div>
                    <div class="p-3 flex-grow-1 m-3" style="overflow-y: auto;">
                        <div class="d-flex flex-column h-100 mt-3 justify-content-center">
                            <MudText Typo="Typo.h6">Stellar Chat</MudText>
                        </div>
                    </div>
                </div>
            </div>
        </MudContainer>
    </MudDrawer>

    <MudMainContent>
        <!-- Main content will go here -->
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen = true;
    private bool _IsDarkModeEnabled = false;

    protected override async Task OnInitializedAsync()
    {
        var darkModeValue = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "darkMode");

        if (!string.IsNullOrEmpty(darkModeValue))
        {
            _IsDarkModeEnabled = bool.Parse(darkModeValue);
        }
    }

    private async Task ToggleDarkMode()
    {
        _IsDarkModeEnabled = !_IsDarkModeEnabled;

        await JSRuntime.InvokeVoidAsync("localStorage.setItem", "darkMode", _IsDarkModeEnabled);
    }

    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;
}

@Body
