@inject IChatService _chatService

<MudDrawer @bind-Open="IsDrawerOpen" Elevation="1" ClipMode="DrawerClipMode.Never" Variant="DrawerVariant.Persistent" Anchor="Anchor.Left" Width="480px">
    <MudContainer Class="d-flex pa-0 overflow-x-hidden" Style="height: 100%; width: 100%;">
        <div class="d-flex flex-column" style="width: 100%;">
            <div class="d-flex flex-1 w-100 overflow-hidden">

                @*------------ left column ------------ *@
                <div id="drawer-left-column" class="d-flex flex-column align-items-center pa-1" style="width:72px;">
                    <MudAvatar Size="Size.Large" Color="Color.Secondary" Class="mt-3 mx-auto">
                        <MudImage Src="https://avatars.githubusercontent.com/u/49451143?v=4" Alt="An image of the best dog ever!"></MudImage>
                    </MudAvatar>
                    <div class="d-flex flex-column align-items-center flex-grow-1 fixed mb-2" style="bottom: 6px">
                        <MudTooltip Text="New chat" Arrow="true" Placement="Placement.Right" >
                            <MudFab Size="Size.Medium" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" Class="mb-4 ml-2" />
                        </MudTooltip>
                        <MudDivider Class="mx-auto" Style="width:70%;" />
                        <MudTooltip Text="Settings" Arrow="true" Placement="Placement.Right">
                            <MudIconButton Style="margin-left: 2px;" Size="Size.Large" Icon="@Icons.Material.Filled.Settings" />
                        </MudTooltip >
                    </div>
                </div>
                <MudDivider Vertical="true" />

                @*------------ right column ------------ *@
                <div id="drawer-right-column" class="p-3 flex-grow-1 overflow-y-auto w-100 h-100">
                    <div class="d-flex flex-column h-100">
                        <MudText Typo="Typo.h5" Class="mx-auto mt-3 mb-2">Stellar Chat</MudText>
                        <MudDivider />
                        <MudText Typo="Typo.h6" Class="mt-2 ml-4">Chat History</MudText>
                        <div class="flex-grow-1 overflow-y-auto w-100 h-100 mt-1">
                            <MudTextField Class="pl-4 pr-4 pb-4" @bind-Value="@SearchText" Label="Find a conversation" Variant="Variant.Outlined" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.Search" />
                            <MudDivider />
                            <MudList Clickable="true">
                                @foreach (var chatSession in ChatSessions)
                                {
                                    <ChatHistoryItem ChatSessionItem="@chatSession" />
                                }
                            </MudList>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </MudContainer>
</MudDrawer>


@code
{
    [Parameter]
    public bool IsDrawerOpen { get; set; }

    public string SearchText { get; set; } = string.Empty;

    public List<ChatSessionResponse> ChatSessions { get; set; } = new();

    protected override async Task OnInitializedAsync() 
        => await LoadChatSessions();

    private async Task LoadChatSessions()
    {
        var response = await _chatService.BrowseChatSessions();
        ChatSessions = response.Items.ToList();
    }
}
